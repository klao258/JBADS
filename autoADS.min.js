(async()=>{let{fbtg,fbss,tstg,tsss,jbtg,jbss,accountAll,texts,GQText,copyText,guid,getRNum,sleep,date,timestampToDate,minViews}=autoADSData,db=window.db,cpms_store=window.cpms_store,pviews_store=window.pviews_store,accountObj={adsUid:"",adsUname:"",tgName:window.user},getHTML=((e=>{let s=e.pushState,o=e.replaceState;function n(e,t){t=new URL(t||window.location.href,window.location.origin).pathname;window.dispatchEvent(new CustomEvent("routechange",{detail:{type:e,route:t}}))}e.pushState=function(e,t,a){var r=s.apply(this,arguments);return n("push",a),r},e.replaceState=function(e,t,a){var r=o.apply(this,arguments);return n("replace",a),r},window.addEventListener("popstate",()=>{n("pop",window.location.href)}),n("init",window.location.href)})(window.history),window.addEventListener("routechange",function(e){var{route:e=""}=e?.detail;"/account"===e?(console.log("ÂõûÂà∞È¶ñÈ°µ"),$("#hoverTooltip")?.remove(),$("#buttonContainer")?.show?.()):(console.log("Á¶ªÂºÄÈ¶ñÈ°µ"),$("#hoverTooltip")?.remove(),$("#buttonContainer")?.hide?.())}),(a,r,s=!0)=>new Promise((t,e)=>{$.get(a,e=>{e=s?(new DOMParser).parseFromString(e[r],"text/html"):e;t($(e))}).fail(e=>{t(!1)})})),getAdsAcountInfo=async()=>{var e=await getHTML("https://ads.telegram.org/account/edit","h",!0);accountObj.adsUid=e?.find?.(".field-disabled .pr-form-control").val(),accountObj.adsUname=e?.find?.("#full_name").val()},getPlatform=(await getAdsAcountInfo(),e=>fbtg?.includes?.(e)?"ÈáëË≤ùÂ®±‰πê":fbss?.includes?.(e)?"ÈáëË≤ùÊêúÁ¥¢ÂπøÂëä":tstg?.includes?.(e)?"Â§©ËÉúÂ®±‰πê":tsss?.includes?.(e)?"Â§©ËÉúÊêúÁ¥¢ÂπøÂëä":jbtg?.includes?.(e)?"ÈáëÂçöÂ®±‰πê":jbss?.includes?.(e)?"ÈáëÂçöÊêúÁ¥¢ÂπøÂëä":"Êú™Áü•Âπ≥Âè∞"),platformText=getPlatform(accountObj.adsUid),postDate=(accountObj.platform=platformText,await window.get("/user/getAccoutPost",{platform:accountObj.platform,ads:autoADSData?.accountAll?.[accountObj.adsUid]?.en})),isShowData=!0,viewListTmp=(window.postData=isShowData&&postDate?.data||[],await window.get("/ads/getAdsDailyStats",{platform:platformText,adsUid:accountObj.adsUid})),viewList=viewListTmp?.data||[];console.log("ÈùôÊÄÅÊï∞ÊçÆ",autoADSData),console.log("Â∏ñÂ≠êÊï∞ÊçÆ",window.postData),console.log("ÊµèËßàÊï∞ÊçÆ",viewList),window.isLoad=!1;let animationFrameId;var timerID=null,host="https://ads.telegram.org",maxWidth="100%",loadADSFlag=!1;let getShortId=async e=>{let a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var t,r,s;return t=6,r=(e=>{try{e=(e=e.replace(/https\:\/\/t.me\//g,"@")).replace(/@/g,"");var t=new URL(e).pathname.split("/").filter(Boolean);return 0===t.length?e:"joinchat"===t[0]&&t[1]?t[1]:t[0]}catch{return e}})(e=e),s=(new TextEncoder).encode(r),s=await crypto.subtle.digest("SHA-256",s),s=new Uint8Array(s).slice(0,6),s=Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join(""),s=parseInt(s,16),console.log(e,r),await(e=>{let t="";for(;0<e;)t=a[e%62]+t,e=Math.floor(e/62);return t.padStart(6,"a")})(s).slice(0,t)},statusOrder={"In Review":1,Declined:2,Active:3,"On Hold":4,Stopped:5},confirm=async a=>new Promise((t,e)=>{Swal.fire({text:a,position:"top",backdrop:!1,showCancelButton:!0,confirmButtonText:"Á°ÆÂÆö",cancelButtonText:"ÂèñÊ∂à"}).then(e=>{e.isConfirmed?t(!0):t(!1)})}),toast=(e,t)=>{Swal.fire({toast:!0,position:"top-end",icon:"success",title:e,showConfirmButton:!1,timer:4e3,timerProgressBar:!0,didClose:()=>{t&&t()}})},toastErr=(e,t="",a=4e3)=>{Swal.fire({toast:!0,position:"top-end",icon:"error",title:e,text:t,showConfirmButton:!1,timer:a,timerProgressBar:!0})},prompt=e=>new Promise(t=>{Swal.fire({title:e,input:"text",inputPlaceholder:"ËØ∑ËæìÂÖ•",inputValidator:e=>e?(e=parseFloat(e),isNaN(e)||e<=0?"‚ö†Ô∏è ËØ∑ËæìÂÖ•‰∏Ä‰∏™Â§ß‰∫é0ÁöÑÊ≠£Á°ÆÊï∞Â≠óÔºÅ":null):"‚ùå ËØ∑ËæìÂÖ•‰ª∑Ê†ºÔºÅ",showCancelButton:!0,confirmButtonText:"Á°ÆËÆ§",cancelButtonText:"ÂèñÊ∂à",focusConfirm:!1,preConfirm:e=>parseFloat(e)}).then(e=>{e.isConfirmed?(e=e.value,t(e)):t(0)})}),rawConfidence=(e,t)=>"number"!=typeof e||isNaN(e)?0:Math.min(e/t,1),safeDiv=(e,t)=>!t||isNaN(e)||isNaN(t)?0:e/t,scoreAd=e=>{var{clicks:e=0,regs:t=0,pays:a=0,money:r=0,ctr:s=0,cvr:o=0}=e,e=(safeDiv(t,e),Number((40*rawConfidence(r,300)).toFixed(2))),r=Number((30*rawConfidence(a,10)).toFixed(2)),a=Number((20*rawConfidence(t,30)).toFixed(2)),t=o?Number(Math.min(5,o/100*5*2).toFixed(2)):0,o=s?Number(Math.min(5,s/100*5*5).toFixed(2)):0,s=Number((e+r+a+t+o).toFixed(2));let n="";return{score:s,suggestion:n=85<=s?"‚úÖ Ë°®Áé∞‰ºòÂºÇÔºåÂª∫ËÆÆÂä†Â§ßÈ¢ÑÁÆóÊâ©Â§ßÊäïÊîæ":70<=s?"üü° ÊïàÊûúËâØÂ•ΩÔºåÂª∫ËÆÆÁªßÁª≠ÊäïÊîæÂπ∂ÂæÆË∞ÉÁ¥†Êùê":50<=s?"üîª ÊïàÊûú‰∏ÄËà¨ÔºåÂª∫ËÆÆË∞É‰ΩéÂá∫‰ª∑ÊàñË∞ÉÊï¥Âèó‰ºó":"‚õî ÊïàÊûúËæÉÂ∑ÆÔºåÂª∫ËÆÆÊöÇÂÅúÊäïÊîæÊàñÂ§ßÂπÖÈáçÊûÑ",details:{moneyScore:e,paysScore:r,regsScore:a,cvrScore:t,ctrScore:o}}},createView=()=>{var e=$("<button>",{text:"Êî∂Ëµ∑ ‚ñ≤",class:"toggle-btn",click:function(){t.data("collapsed")?(t.children().not(".toggle-btn").show(),$(this).text("Êî∂Ëµ∑ ‚ñ≤"),t.data("collapsed",!1)):(t.children().not(".toggle-btn").hide(),$(this).text("Â±ïÂºÄ ‚ñº"),t.data("collapsed",!0))}}).css({width:"100%",marginBottom:"5px",padding:"5px",fontSize:"12px",backgroundColor:"#f0f0f0",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"});let t=$("<div>",{id:"buttonContainer"}).css({position:"fixed",top:"0",right:"0",display:"flex",flexWrap:"wrap",gap:"2px 5px",width:"140px",zIndex:1,background:"#fff",padding:"5px",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.2)"});t.data("collapsed",!1),t.append(e);e=$("<textarea>",{class:"urls"}).attr("placeholder","ËØ∑ËæìÂÖ•È¢ëÈÅì/Êú∫Âô®‰∫∫ÈìæÊé•, Â§ö‰∏™ÈìæÊé•ÈúÄË¶ÅÊç¢Ë°å").css({width:"100%",height:"100px",border:"1px solid #ccc",padding:"5px",borderRadius:"5px",fontSize:"14px",resize:"none"});let a=$("<select>",{class:"select"}).css({flex:1,padding:"5px",borderRadius:"5px",fontSize:"14px"}),r=(accountAll?.[accountObj.adsUid]?.options?.map?.(e=>{a.append($(`<option value="${e.tgname}">${e.label}</option>`))}),$("<select>",{class:"GQClassify"}).css({flex:1,padding:"5px",borderRadius:"5px",fontSize:"14px"}));Object.keys(GQText).map(e=>r.append($(`<option value="${e}">${e}</option>`)));var s=$(`
            <div id="priceContainer">
                <label class="rangeLabel" style="font-weight: 400; font-size: 12px; margin-bottom: 0;">Âçï‰ª∑Ôºö</label>
                <input type="number" id="minPrice" class="price-input" style="flex: 1; border: 1px solid #ccc; width: 40px;" value="15" min="0.1" max="50" step="0.1">
                <label> - </label>
                <input type="number" id="maxPrice" class="price-input" style="flex: 1; border: 1px solid #ccc; width: 40px;" value="30" min="0.1" max="50" step="0.1">
            </div>
        `).css({flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"160px",background:"rgba(255, 255, 255, 0.9)"}),o=$(`
            <div id="budgetContainer">
                <label class="rangeLabel" style="font-weight: 400; font-size: 12px; margin-bottom: 0;">È¢ÑÁÆóÔºö</label>
                <input type="number" id="minBudget" class="budget-input" style="flex: 1; border: 1px solid #ccc; width: 40px;" value="1" min="1" max="50" step="1">
                <label> - </label>
                <input type="number" id="maxBudget" class="budget-input" style="flex: 1; border: 1px solid #ccc; width: 40px;" value="1" min="1" max="50" step="1">
            </div>
        `).css({flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"180px",background:"rgba(255, 255, 255, 0.9)"}),n=(e,t,a)=>!(fbtg?.includes?.(accountObj.adsUid)||tstg?.includes?.(accountObj.adsUid)||jbtg?.includes?.(accountObj.adsUid))&&["textTeviewBtn"].includes(t)||(fbtg?.includes?.(accountObj.adsUid)||tstg?.includes?.(accountObj.adsUid)||jbtg?.includes?.(accountObj.adsUid))&&["searchADSBtn"].includes(t)?null:$("<button>",{text:e,class:t,click:a}).css({padding:"4px 6px",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"12px",whiteSpace:"nowrap",flex:1}),n=[n("ÂçïÈìæÂèëÂ∏É","newADBtn",()=>sendChannel()),n("Â§öÈìæÂèëÂ∏É","sendMoreUrl",()=>sendMoreChannel()),n("ÊêúÁ¥¢ÂπøÂëä","searchADSBtn",()=>onSearchADS()),n("‰∏ÄÈîÆÈáçÂÆ°","reviewBtn",async()=>onReview()),n("Âä†È¢ÑÁÆó","addMount",async()=>addMountFn()),n("Âçï‰ª∑‰ºòÂåñ","cpmOptimize",async()=>onCPMOptimize()),n("ÊïàÊûúÂ∑ÆÂ∏ñÂ≠êÊñáÊ°àÊõøÊç¢","textTeviewBtn",async()=>onReplace()),n("Âà†Èô§0ËØÑÂàÜÂÆ°Ê†∏Â§±Ë¥•","delBtn",async()=>onDels()),n("Êèê‰ª∑(ÊõùÂÖâ‰∏çË∂≥)","proPrice",async()=>onProPrice()),n("Êèê‰ª∑(ÊõùÂÖâËææÊ†á)","proPrice",async()=>onProAddPrice()),n("Âà∑Êñ∞È°µÈù¢","refreshBtn",async()=>onRefresh()),n("Á≠õÈÄâ‰ΩéËØÑÂàÜÂπøÂëä","refreshBtn",async()=>onFilter()),n("Á≠õÈÄâËã±ÊñáÂêçÂπøÂëä","refreshBtn",async()=>onGetENFilter()),n("‰ªäÊó•Êï∞ÊçÆ","getTodayData",async()=>onGetTodayData()),n("Êú∫Âô®‰∫∫ÊäïÊîæÊ£ÄÊµã","botVerify",async()=>onBotVerify()),n("Ëé∑ÂèñÊÄªÊï∞ÊçÆ","amountTotal",async()=>getAdsStatis())];t.append(e,a,accountAll?.[accountObj.adsUid]?.options?.find?.(e=>"jbgq"===e?.tgname)?r:null,s,o,...n);$("<style>").html(".swal2-toast { font-size: 12px; !important; }").appendTo("head"),$("body").append(t)},getMonthTotal=(createView(),window.ajInit=options=>{if(!window.history||!history.pushState)return!1;var nav_url=location.href,short_url=layerUrlToShort(nav_url),$progress=(options.layer&&!short_url&&(nav_url=layerUrlToNav(nav_url,options.layerUnderUrl)),history.state?history.state.u?short_url&&location.href!=short_url&&history.replaceState(history.state,null,short_url):history.replaceState({i:history.state.i,u:nav_url},null,short_url):history.replaceState({i:0,u:nav_url},null,short_url),$("#aj_progress")),progressBoxShadow="inset 0 2px 0 var(--accent-color, #39ade7)",progressNoBoxShadow="inset 0 0 0 var(--accent-color, #39ade7)",progressTransition="width .3s linear, box-shadow .2s ease",progressTo,progressVal=0,skipPopState=($progress.css({width:0,transition:progressTransition,position:"fixed",zIndex:1e3,top:0,height:3}),!1),curHistoryState=history.state,curLocation=loc(curHistoryState.u),layerCloseLocation=layerCloseLoc(curHistoryState.u),underLayerTitle=document.title,curOnLoad=[],curOnUnload=[],curOnLayerLoad=[],curOnLayerUnload=[],curBeforeUnload=!1,curBeforeLayerUnload=!1,ajContainer=$("#aj_content");function showProgress(){clearTimeout(progressTo),progressTo=progressVal?setTimeout(showProgress,300):($progress.css({width:0,transition:"none"}),setTimeout(function(){$progress.css({transition:progressTransition}),showProgress()},50)),$progress.css({width:progressVal+"%",boxShadow:progressBoxShadow}),progressVal+=(99-progressVal)/4}function hideProgress(e){clearTimeout(progressTo),progressTo=!1,progressVal=0,$progress.css({width:e?"0%":"100%"}),setTimeout(function(){$progress.css({boxShadow:progressNoBoxShadow})},300)}function apiRequest(e,t,a){return $.ajax(Aj.apiUrl,{type:"POST",data:$.extend(t,{method:e}),dataType:"json",xhrFields:{withCredentials:!0},success:function(e){e._dlog&&$("#dlog").append(e._dlog),a&&a(e)},error:function(e){(e.readyState||e.status)&&(401==e.status?location.href="/auth":0<e.readyState&&location.reload())}})}function uploadRequest(e,t,a,r,s){var o,n=new FormData;for(o in n.append("file",t,t.name),n.append("method",e),a)n.append(o,a[o]);return $.ajax(Aj.apiUrl,{type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,xhrFields:{withCredentials:!0},xhr:function(){var e=new XMLHttpRequest;return e.upload.addEventListener("progress",function(e){e.lengthComputable&&s&&s(e.loaded,e.total)}),e},beforeSend:function(e){s&&s(0,1)},success:function(e){e._dlog&&$("#dlog").append(e._dlog),r&&r(e)},error:function(e){401==e.status?location.href="/auth":0<e.readyState&&r&&r({error:"Network error"})}})}function loc(e){var t=document.createElement("a");return t.href=e,t}function layerHref(e){for(var t=document.createElement("a"),e=(t.href=e,t.search),a=(e="?"==e.substr(0,1)?e.substr(1):e).split("&"),r=0;r<a.length;r++){var s=a[r].split("=");if("l"==s[0])return decodeURIComponent(s[1]||"")}return null}function layerOpenHref(e,t){var a=document.createElement("a");return a.href=e,a.search=a.search.replace(/&l=[^&]*/g,"",a.search),a.search=a.search.replace(/(\?)l=[^&]*&|\?l=[^&]*$/g,"$1",a.search),a.search+=(a.search?"&":"?")+"l="+encodeURIComponent(t),a.href}function layerCloseLoc(e){var t=document.createElement("a");return t.href=e,t.search=t.search.replace(/&l=[^&]*/g,"",t.search),t.search=t.search.replace(/(\?)l=[^&]*&|\?l=[^&]*$/g,"$1",t.search),t}function layerUrlToShort(e){var t=document.createElement("a"),e=(t.href=e,t.search.match(/(\?|&)l=([^&]*)/));return e?"/"+decodeURIComponent(e[2]):null}function layerUrlToNav(e,t){var a;return layerUrlToShort(e)?e:((a=document.createElement("a")).href=e,layerOpenHref(t||"/",a.pathname.replace(/^\/+|\/+$/g,"")))}function changeLocation(e,t){t?location.href=e:location.replace(e)}function scrollToEl(e){$(window).scrollTop($(e).offset().top)}function scrollToHash(e){if(e="#"==(e=e||curLocation.hash)[0]?e.substr(1):e){var t=document.getElementById(e);if(t)return scrollToEl(t);(t=$("a[name]").filter(function(){return $(this).attr("name")==e}).eq(0)).length&&scrollToEl(t)}}function onLoad(e){curOnLoad.push(e)}function onUnload(e){curOnUnload.push(e)}function onLayerLoad(e){curOnLayerLoad.push(e)}function onLayerUnload(e){curOnLayerUnload.push(e)}function onBeforeUnload(e){curBeforeUnload=e}function onBeforeLayerUnload(e){curBeforeLayerUnload=e}function pageLoaded(){if(curOnLoad.length)for(var e=0;e<curOnLoad.length;e++)curOnLoad[e](Aj.state);onUnload(function(){$(ajContainer).off(".curPage"),$(document).off(".curPage")}),$(ajContainer).trigger("page:load"),Aj.layer&&layerLoaded()}function layerLoaded(){if(curOnLayerLoad.length)for(var e=0;e<curOnLayerLoad.length;e++)curOnLayerLoad[e](Aj.layerState);onLayerUnload(function(){Aj.layer.off(".curLayer")}),Aj.layer.one("popup:close",function(){if(curOnLayerUnload.length)for(var e=0;e<curOnLayerUnload.length;e++)curOnLayerUnload[e](Aj.layerState);Aj.layer.remove(),underLayerTitle&&(document.title=underLayerTitle),layerCloseLocation&&(setLocation(layerCloseLocation.href),layerCloseLocation=!1),Aj.layer=!1,Aj.layerState={},curOnLayerLoad=[],curOnLayerUnload=[]}),Aj.layer.on("click.curLayer","a[data-layer-close]",function(e){e.preventDefault(),e.stopImmediatePropagation(),closePopup(Aj.layer)}),openPopup(Aj.layer,{closeByClickOutside:".popup-no-close",onBeforeClose:function(e){return checkBeforeUnload(function(){e.data("options").onBeforeClose=null,closePopup(e)})}}),$(ajContainer).trigger("layer:load")}function onResult(url,http_code,result,push_state){if(hideProgress(),200==http_code&&result&&result.v&&result.v==Aj.version){var url_hash=loc(url).hash,redirect_url;if(result.r)redirect_url=result.r,url_hash&&(redirect_url=redirect_url.split("#")[0]+url_hash),!result.hr&&loadPage(loc(redirect_url),push_state)||changeLocation(redirect_url,push_state);else{var saved_ult=underLayerTitle,saved_lcl=(!Aj.layer||!push_state)&&layerCloseLocation;if(underLayerTitle=!1,layerCloseLocation=!1,closeAllPopups(),underLayerTitle=saved_ult,layerCloseLocation=saved_lcl,result.h){if(curOnUnload.length)for(var i=0;i<curOnUnload.length;i++)curOnUnload[i](Aj.state);push_state&&(result.l&&(url=layerUrlToNav(url)),setLocation(url)),Aj.state={},curOnLoad=[],curOnUnload=[],result.t&&(document.title=result.t,underLayerTitle=document.title),result.h&&ajContainer.html(result.h),result.s&&$.extend(Aj.state,result.s),document.documentElement.className=result.rc||"",result._dlog&&$("#dlog").html(result._dlog),!push_state&&Aj._useScrollHack||$(window).scrollTop(0),unfreezeBody(),url_hash&&scrollToHash(),result.l&&(Aj.layer=$('<div class="popup-container hide" id="layer-popup-container"></div>'),Aj.layerState={},curOnLayerLoad=[],curOnLayerUnload=[],result.lt&&(document.title=result.lt),result.ls&&$.extend(Aj.layerState,result.ls),Aj.layer.html(result.l).appendTo(document.body)),result.j&&(window.execScript?window.execScript(result.j):eval(result.j)),pageLoaded()}else result.l?(push_state&&(url=layerUrlToNav(url),setLocation(url)),result.s&&$.extend(Aj.state,result.s),result._dlog&&$("#dlog").html(result._dlog),Aj.layer=$('<div class="popup-container hide" id="layer-popup-container"></div>'),Aj.layerState={},curOnLayerLoad=[],curOnLayerUnload=[],result.lt&&(document.title=result.lt),result.ls&&$.extend(Aj.layerState,result.ls),Aj.layer.html(result.l).appendTo(document.body),result.j&&(window.execScript?window.execScript(result.j):eval(result.j)),layerLoaded()):changeLocation(url,push_state)}}else changeLocation(url,push_state)}function loadPage(e,r,t){var s=e.href,a=curLocation.href,o=curLocation.origin+curLocation.pathname+curLocation.search;if(e.origin!=curLocation.origin)return!1;if(e.pathname==curLocation.pathname&&e.search==curLocation.search&&e.hash!=curLocation.hash)return!1;s==a&&(r=!1);var n=!1;return(n=!checkBeforeUnload(function(){r||(n&&historyJump(t),curLocation=loc(s),layerCloseLocation=layerCloseLoc(s)),n&&Aj.layer&&(Aj.layer.data("options").onBeforeClose=null),showProgress(),$.ajax(s,{dataType:"json",xhrFields:{withCredentials:!0},headers:{"X-Aj-Referer":o},success:function(e,t,a){onResult(s,a.status,e,r)},error:function(e){onResult(s,e.status,!1,r)}})}))&&!r&&historyJump(-t),!0}function _location(e,t){if(void 0===e)return loc(curLocation.href);e=loc(e),t=!t;loadPage(e,t)||changeLocation(e,t)}function layerLocation(e){if(void 0===e)return layerHref(curLocation.href);loadPage(loc(layerOpenHref(curLocation,e)),!0)}function setLocation(e,t=!1){var e=loc(e).href,a=layerUrlToShort(e)||e;t?history.replaceState({i:curHistoryState.i,u:e},null,a):history.pushState({i:curHistoryState.i+1,u:e},null,a),curHistoryState=history.state,curLocation=loc(curHistoryState.u),layerCloseLocation=layerCloseLoc(curHistoryState.u)}function setLayerLocation(e){e=e.toString().replace(/^\/+|\/+$/g,"");var e=loc(layerOpenHref(curLocation,e)).href,t=layerUrlToShort(e)||e;history.pushState({i:curHistoryState.i+1,u:e},null,t),curHistoryState=history.state,curLocation=loc(curHistoryState.u)}function reload(){_location(_location(),!0)}function historyJump(e){e&&(skipPopState=!0,history.go(e))}function needAuth(){return!!Aj.unauth&&(openPopup("#login-popup-container"),!0)}function linkHandler(e){var t,a;return!(!e.metaKey&&!e.ctrlKey)||(t=this.href,this.hasAttribute("data-unsafe")&&t!=$(this).text()?(a=showConfirm(l("WEB_OPEN_LINK_CONFIRM",{url:cleanHTML(t)},"Do you want to open <b>{url}</b>?"),null,l("WEB_OPEN_LINK","Open")),$(".popup-primary-btn",a).attr({href:t,target:$(this).attr("target"),rel:$(this).attr("rel")}),!1):"_blank"==$(this).attr("target")||(this.hasAttribute("data-layer")&&(t=layerUrlToNav(t,curLocation)),void(($(this).hasClass("need-auth")&&needAuth()||loadPage(loc(t),!0))&&e.preventDefault())))}function beforeUnloadHandler(e){var t=null;if(t=!(t=Aj.layer&&curBeforeLayerUnload?curBeforeLayerUnload():t)&&curBeforeUnload?curBeforeUnload():t)return(e=void 0===e?window.e:e)&&(e.returnValue=t),t}function checkBeforeUnload(e){function t(){curBeforeUnload=curBeforeLayerUnload=!1,e()}var a=null;return(a=!(a=Aj.layer&&curBeforeLayerUnload?curBeforeLayerUnload():a)&&curBeforeUnload?curBeforeUnload():a)?(a=$("<div>").text(a).html(),showConfirm(a,t,l("WEB_LEAVE_PAGE","Leave")),!1):(t(),!0)}window.Aj={apiUrl:options.apiUrl,version:options.version,unauth:options.unauth||!1,onLoad:onLoad,onUnload:onUnload,onLayerLoad:onLayerLoad,onLayerUnload:onLayerUnload,pageLoaded:pageLoaded,layerLoaded:layerLoaded,showProgress:showProgress,hideProgress:hideProgress,onBeforeUnload:onBeforeUnload,onBeforeLayerUnload:onBeforeLayerUnload,linkHandler:linkHandler,location:_location,layerLocation:layerLocation,setLocation:setLocation,setLayerLocation:setLayerLocation,reload:reload,apiRequest:apiRequest,uploadRequest:uploadRequest,needAuth:needAuth,ajContainer:ajContainer,state:options.state||{},layerState:{},globalState:{},layer:!1},options.layer&&(Aj.layer=$("#layer-popup-container"),Aj.layerState=options.layerState||{},options.layerTitle)&&(document.title=options.layerTitle),$(document).on("click","a[href]",linkHandler),$(document.body).removeClass("no-transition"),$(window).on("popstate",function(e){var e=e.originalEvent.state,t=e?e.i-curHistoryState.i:0;e?e.u||(e.u=location.href):e={i:0,u:location.href},curHistoryState=e,skipPopState?skipPopState=!1:(Aj._useScrollHack&&freezeBody(),!loadPage(loc(curHistoryState.u),!1,t)&&Aj._useScrollHack&&unfreezeBody())}),window.onbeforeunload=beforeUnloadHandler},window.OwnerAds={init:function(){var t=window.Aj.ajContainer;window.Aj.onLoad(function(e){e.$searchField=$(".pr-search-input"),e.$adsListTable=$(".pr-table"),e.$searchResults=$(".pr-table tbody"),Ads.fieldInit(e.$searchField),t.on("click.curPage",".pr-cell-sort",OwnerAds.eSortList),t.on("click.curPage",".pr-table-settings",OwnerAds.eSettingsOpen),t.on("click.curPage",".js-clone-ad-btn",EditAd.eCloneAd),t.on("click.curPage",".delete-ad-btn",EditAd.deleteAd),e.$tableColumnsPopup=$(".js-table-columns-popup"),e.$tableColumnsForm=$(".js-table-columns-form"),e.$tableColumnsForm.on("change.curPage","input.checkbox",OwnerAds.eColumnChange),e.$tableColumnsForm.on("submit.curPage",preventDefault),e.$searchField.initSearch({$results:e.$searchResults,emptyQueryEnabled:!0,updateOnInit:!0,resultsNotScrollable:!0,itemTagName:"tr",enterEnabled:function(){return!1},renderItem:function(t,e){var a,r,s=' href="'+t.base_url+t.status_url+'" '+(t.status_attrs||"data-layer"),o="pr-trg-type-"+t.trg_type,n=(t.tme_path?(a="https://t.me/"+t.tme_path,r="t.me/"+t.tme_path):t.promote_url?r=(a=t.promote_url).replace(/^https?:\/\//,"").replace(/\/$/,""):(a="#",r=l("WEB_ADS_NO_TME_LINK")),!1!==t.actions?formatNumber(t.actions):"‚Äì"),i=!1!==t.opens?formatNumber(t.opens):"‚Äì",d=!1!==t.clicks?formatNumber(t.clicks):"‚Äì",c=!1!==t.ctr?t.ctr+"%":"‚Äì",u=!1!==t.cvr?t.cvr+"%":"‚Äì",p=!1!==t.cpc?Ads.wrapAmount(t.cpc):"‚Äì",h=(!1!==t.cps&&Ads.wrapAmount(t.cps),!1!==t.cpa?Ads.wrapAmount(t.cpa):"‚Äì"),g=!1!==t.daily_spent?"<small><br>"+Ads.wrapAmount(t.daily_spent)+"</small>":"",f=!1!==t.daily_budget?'<small><br><a href="'+t.base_url+'/edit_daily_budget" data-layer>'+Ads.wrapAmount(t.daily_budget)+"</a></small>":"";return`<td>
                            <div class="pr-cell pr-cell-title ${o}" style="position: relative; padding-left: 30px;">
                                <a href="${t.base_url}" class="pr-link">${t.title}</a>
                                

								<small style="display:var(--coldp-url,inline)">
									<br>
									<a href="${t.tgname}" target="_blank">${t.tgname?.replace("https://t.me/","@")}</a>
								</small>
                            </div>
                        </td>

                        ${1===accountAll?.[accountObj.adsUid]?.options?.length&&!window.user.includes("ÈáëÂçö")&&isShowData?`
                                <td><div class="pr-cell regs">${t.regs||""}</div></td>
                                <td><div class="pr-cell pays">${t.pays||""}</div></td>
                                <td><div class="pr-cell money">${t.money||""}</div></td>
                            `:""}
                        
                        <td><div class="pr-cell qviews" style="color: ${+t?.qviews<+minViews?"green":""};">${formatNumber(t?.qviews)||""}</div></td>

                        <td><div class="pr-cell qspent">${Ads.wrapAmount(t?.qspent)}</div></td>

                        <td><div class="pr-cell pviews" style="cursor: pointer; color: ${+t?.pviews<+t?.qviews?"red":""};">${formatNumber(t?.pviews)||""}</div></td>

                        <td><div class="pr-cell pspent">${Ads.wrapAmount(t?.pspent)}</div></td>

                        <td style="display:var(--coldp-views,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${formatNumber(t.views)}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-opens,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${i}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-clicks,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${d}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-actions,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${n}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-ctr,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${c}</a>
                            </div>
                        </td>
						<td style="display:var(--coldp-cvr,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${u}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-cpm,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/edit_cpm" data-layer>${Ads.wrapAmount(t.cpm)}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-cpc,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${p}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-cpa,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${h}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-spent,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/stats" class="pr-link">${Ads.wrapAmount(t.spent)+g}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-budget,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}/edit_budget" data-layer>${Ads.wrapAmount(t.budget)}</a>
                                ${f}
                            </div>
                        </td>
                        <td style="display:var(--coldp-target,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}" class="pr-link">${t.target}</a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-status,table-cell)">
                            <div class="pr-cell">
                                <a ${s}>
                                ${[{status:"Active",label:"ÈÄöËøá"},{status:"In Review",label:"ÂÆ°Ê†∏‰∏≠"},{status:"Declined",label:"ÊãíÁªù"},{status:"On Hold",label:"ÊöÇÂÅú"},{status:"Stopped",label:"È¢ÑÁÆó‰∏çË∂≥"}].find(e=>e.status===t.status)?.label||t.status}
                                </a>
                            </div>
                        </td>
                        <td style="display:var(--coldp-date,table-cell)">
                            <div class="pr-cell">
                                <a href="${t.base_url}" class="pr-link">${date.formatCustomDate(t.date)}</a>
                            </div>
                        </td>
                        <td>
                            <div class="pr-actions-cell">
                                ${Aj.state.adsDropdownTpl.replace(/\{ad_id\}/g,t.ad_id).replace(/\{promote_url\}/g,a).replace(/\{promote_url_text\}/g,r).replace(/\{ad_text\}/g,t.text)}
                            </div>
                        </td>`},renderLoading:function(){return'<tr><td colspan="100" class="pr-cell-empty"><div class="pr-cell">'+l("WEB_OWNER_ADS_LOADING")+"</div></td></tr>"},renderNoItems:function(e){return Aj.state.adsListIsLoading?'<tr><td colspan="100" class="pr-cell-empty-full"><div class="pr-cell">'+l("WEB_OWNER_ADS_LOADING")+"</div></td></tr>":'<tr><td colspan="100" class="pr-cell-empty-full"><div class="pr-cell">'+l("WEB_OWNER_NO_ADS")+"</div></td></tr>"},appendToItems:function(e,t){return Aj.state.adsListIsLoading&&0<t?'<tr><td colspan="100" class="pr-cell-empty"><div class="pr-cell">'+l("WEB_OWNER_ADS_LOADING")+"</div></td></tr>":""},getData:function(){return OwnerAds.getAdsList()}})}),window.Aj.onUnload(function(e){Ads.fieldDestroy(e.$searchField),e.$searchField.destroySearch(),e.$tableColumnsForm.off(".curPage")})},eSortList:function(e){var t=$(this),a=t.attr("data-sort-by"),t=t.hasClass("sort-asc");a==Aj.state.adsListSortBy?Aj.state.adsListSortAsc=!t:(Aj.state.adsListSortBy=a,Aj.state.adsListSortAsc=!1),OwnerAds.updateAdsList(),Aj.state.$searchField.trigger("datachange")},eSettingsOpen:function(){openPopup(Aj.state.$tableColumnsPopup,{closeByClickOutside:".popup-no-close"})},eColumnChange:function(){var e=$(this).prop("name"),t=$(this).prop("checked");Aj.state.$adsListTable.cssProp("--coldp-"+e,t?"":"none"),OwnerAds.submitColumns()},submitColumns:function(){for(var e=Aj.state.$tableColumnsForm,t=[],a=0;a<Aj.state.adsListAllColumns.length;a++){var r=Aj.state.adsListAllColumns[a];e.field(r).prop("checked")&&t.push(r)}return Aj.apiRequest("saveAdsColumns",{columns:t.join(";")}),!1},updateAdsList:function(){var r,s;Aj.state.adsList&&(r=Aj.state.adsListSortBy,s=Aj.state.adsListSortAsc,$(".pr-cell-sort").each(function(){var e=$(this),t=e.attr("data-sort-by");e.toggleClass("sort-active",r==t),e.toggleClass("sort-asc",s&&r==t)}),Aj.state.adsList.sort(function(e,t){var a=s?e:t,t=s?t:e;return a[r]-t[r]||t?.score-a?.score||t?.qviews-a?.qviews||a.date-t.date}))},processAdsList:async function(a,e){$(".table > thead > tr .pviews")?.length||$(".table > thead > tr > th:first").after(`
                    ${1===accountAll?.[accountObj.adsUid]?.options?.length&&!window.user.includes("ÈáëÂçö")&&isShowData?`
                        <th width="65" style="display:var(--coldp-res,table-cell)">
                            <div class="regs pr-cell pr-cell-sort" data-sort-by="regs">Ê≥®ÂÜå<span class="pr-sort-marker"></span></div>
                        </th>
                        <th width="65" style="display:var(--coldp-pays,table-cell)">
                            <div class="pays pr-cell pr-cell-sort" data-sort-by="pays">‰ªòÊ¨æ<span class="pr-sort-marker"></span></div>
                        </th>
                        <th width="65" style="display:var(--coldp-money,table-cell)">
                            <div class="money pr-cell pr-cell-sort" data-sort-by="money">ÊÄªÂÖÖÂÄº<span class="pr-sort-marker"></span></div>
                        </th>
                        `:""}
                        
                    <th width="65" style="display:var(--coldp-qviews,table-cell)">
                        <div class="pr-cell pr-cell-sort" data-sort-by="qviews">Êò®Êó•Â±ïÁ§∫<span class="pr-sort-marker"></span></div>
                    </th>
                    <th width="65" style="display:var(--coldp-qspent,table-cell)">
                        <div class="pr-cell pr-cell-sort" data-sort-by="qspent">Êò®Êó•Ê∂àËÄó<span class="pr-sort-marker"></span></div>
                    </th>
                    <th width="65" style="display:var(--coldp-pviews,table-cell)">
                        <div class="pviews pr-cell pr-cell-sort" data-sort-by="pviews">ÂΩìÂ§©Â±ïÁ§∫<span class="pr-sort-marker"></span></div>
                    </th>
                    <th width="65" style="display:var(--coldp-pspent,table-cell)">
                        <div class="pr-cell pr-cell-sort" data-sort-by="pspent">ÂΩìÂ§©Ê∂àËÄó<span class="pr-sort-marker"></span></div>
                    </th>
                `);var r=date.getBeijingDateOnly(-1),s=date.getBeijingDateOnly(-2);if(e=e||{},a.items){Aj.state.adsList||(Aj.state.adsList=[]);for(var o=[],n=0;n<a.items.length;n++){let e=a.items[n],t=getADSKey(e);var l=viewList?.find?.(e=>e?.ads===t),i=e?.views||0,d=l?.[r]?.views||0,c=l?.[s]?.views||0,u=(+e?.spent-(+l?.[r]?.spent||0)).toFixed(2),p=((+l?.[r]?.spent||0)-(+l?.[s]?.spent||0)).toFixed(2),h=window.postData?.find?.(e=>e?.ads===t),h=(h?(loadADSFlag||(loadADSFlag=!0,$(".pr-logo-title").text(`Telegram Ads Â∑≤Âä†ËΩΩÂàÜÊûêÊï∞ÊçÆ${window.postData.length}Êù°`)),e.pviews=i-d||0,e.pspent=u||0,e.qviews=d-c||0,e.qspent=p||0,e.regs=+h?.regs||0,e.pays=+h?.pays||0,e.money=+h?.money||0):(e.pviews=i-d||0,e.pspent=u||0,e.qviews=d-c||0,e.qspent=p||0,e.regs=0,e.pays=0,e.money=0),e._title=e.title,e.tgname=l?.url||"",scoreAd(e));e.score=h?.score?.toFixed(0)||0,e.scoreDetails=h?.details||{},e.suggestion=h?.suggestion,e.base_url="/account/ad/"+e.ad_id,e._values=[e.title.toLowerCase(),e.tme_path.toLowerCase()],o.push(e)}Aj.state.adsList=[...Aj.state.adsList,...o],Aj.state.adsList.sort((e,t)=>{var a,r=statusOrder[t.status]-statusOrder[e.status];return 0!=r?r:(r=t?.score||0,0<(a=e?.score||0)&&r<=0?-1:0<r&&a<=0?1:0<a&&0<r?r-a:(t?.qviews||0)-(e?.qviews||0))}),Aj.state.$searchField.trigger("contentchange")}a.next_offset_id?(e.offset=a.next_offset_id,OwnerAds.loadAdsList(e),window.isLoad=!1,loadADSFlag=!1):(Aj.state.adsListIsLoading=!1,Aj.state.$searchField.trigger("dataready"),requestIdleCallback(e=>{getMonthTotal(),$("#aj_content").css({width:"89%"}),$(".pr-container").css({"max-width":maxWidth,margin:"0 20px"})},{timeout:2e3}),window.isLoad=!0)},loadAdsList:function(t){t=t||{},Aj.apiRequest("getAdsList",{owner_id:Aj.state.ownerId,offset_id:t.offset},function(e){e.error?(t.retry?t.retry++:t.retry=1,setTimeout(function(){OwnerAds.loadAdsList(t)},1e3*t.retry)):(t.retry&&(t.retry=0),OwnerAds.processAdsList(e,t))})},getAdsList:function(){var e=Aj?.state?.adsList;if(!1!==e){if(e)return e;Aj.state.adsList=!1,Aj.state.adsListIsLoading=!0,Aj.state.initialAdsList?setTimeout(function(){OwnerAds.processAdsList(Aj.state.initialAdsList)},10):OwnerAds.loadAdsList({offset:0})}return!1},updateAd:function(e){if(Aj.state&&Aj.state.adsList)for(var t=Aj.state.adsList,a=0;a<t.length;a++)if(e.ad_id==t[a].ad_id)return e.base_url="/account/ad/"+e.ad_id,e._values=[e.title.toLowerCase(),e.tme_path.toLowerCase()],t[a]=e,OwnerAds.updateAdsList(),void Aj.state.$searchField.trigger("contentchange")}},$.fn.initSearch=function(_){return this.map(function(){var a=$(this),n=a.value(),l=!1,i=[],d=0,r=!1,s=null,o=null,t=!1;function e(e){clearTimeout(o);var t=a.value();clearTimeout(s),n!==t&&(_.onInputBeforeChange&&_.onInputBeforeChange(t),f(),_.onInput&&_.onInput(t),g())}function c(e,t){var a=[];if(a.fullMatchIndex=null,_.emptyQueryEnabled||t.length){new Date;for(var r=_.prepareQuery(t),o=0;o<e.length;o++){var n,l=((e,t)=>{if(_.checkItem)return _.checkItem(e,t);if(!t.length)return 0;for(var a=0;a<e._values.length;a++)if((r=e._values[a])==t)return e._fullmatch=!0,r.length;for(a=0;a<e._values.length;a++){var r,s=(r=e._values[a]).indexOf(t);if(_.prefixOnly?0===s:-1!==s)return r.length}return!1})(n=e[o],r);!1!==l&&(n._score=l,n._top?n._score-=1e7:n._bottom&&(n._score+=1e7),n._i=o,a.push(n))}let s=$(".sort-active");for(a.sort(function(e,t){var a,r;return s.length?e._score-t._score||e._i-t._i:0!=(r=statusOrder[e.status]-statusOrder[t.status])?r:(r=t?.score||0,0<(a=e?.score||0)&&r<=0?-1:0<r&&a<=0?1:0<a&&0<r?r-a:(t?.qviews||0)-(e?.qviews||0))}),o=0;o<a.length;o++)(n=a[o])._fullmatch&&(delete n._fullmatch,null===a.fullMatchIndex)&&(a.fullMatchIndex=o),delete n._score,delete n._i}return a}function u(e,t,a){if(!(a&&a>=e.length)){new Date;a=a||0;var r="",s=_.renderLimit||50;if(0<e.length){for(var o=a,n=0;o<e.length&&n<s;o++,n++){var l=e[o],i=_.itemTagName||"div",l=`<${i} class="${"search-item"+(_.itemClass?" "+_.itemClass:"")+(l.className?" "+l.className:"")}" data-i="${o}">
                                ${_.renderItem(l,t)}
                            </${i}>`;r+=l}d=o}else r=_.renderNoItems?_.renderNoItems(t):"",d=0;e.length<=d&&(r+=_.appendToItems?_.appendToItems(t,e.length):""),e.length||""!=r?(_.$results.isFadeHidden()&&_.$results.fadeShow(),a?r&&_.$results.append(r):_.$results.html(r)):_.$results.fadeHide(function(){_.$results.isFadeHidden()&&_.$results.html(r)}),v()}}function p(){d=0,_.$results.html(""),v()}function h(e){clearTimeout(s),_.$results.hasClass("collapsed")||(_.$enter&&_.enterEnabled()&&_.$enter.removeClass("selected"),e&&_.$results.animOff(),_.$results.addClass("collapsed"),_.onClose&&_.onClose(n),e&&_.$results.animOn())}function g(){a.data("disabled")||(clearTimeout(o),m(l,!0),_.$results.hasClass("collapsed")&&(_.$results.removeClass("collapsed"),_.onOpen)&&_.onOpen())}function f(){clearTimeout(o),clearTimeout(s);var e=a.value();if(n=e,_.searchEnabled()){e=_.getData(e);if(!1===e)return r||(r=!0,a.one("dataready.search",function(){r=!1,f()})),void(n.length||_.emptyQueryEnabled?(d=0,_.$results.html(_.renderLoading?_.renderLoading():""),v):p)();i=c(e,n);var t=!1;(_.resultsNotScrollable?$(window):_.$results).scrollTop(0),n.length||_.emptyQueryEnabled?(u(i,n),i.length&&!_.enterEnabled()&&(t=0),_.selectFullMatch&&null!==i.fullMatchIndex&&(t=i.fullMatchIndex)):p()}else{t=!(i=[]);p()}m(t,!0)}function m(e,t,a){var r,s,o;$(".search-item.selected",_.$results).removeClass("selected"),!1!==(l=e)&&((e=$(".search-item",_.$results).get(l))?($(e).addClass("selected"),t&&(t=$(e),e=a,a=_.$results.scrollTop(),r=t.position().top+a,t=t.outerHeight(),s=r+t,o=_.$results.height()||300,e?_.$results.scrollTop(r-(o-t)/2):r<a?_.$results.scrollTop(r):a+o<s&&_.$results.scrollTop(s-o)),Math.abs(l-d)<5&&u(i,n,d)):l=!1),_.$enter&&_.enterEnabled()&&_.$enter.toggleClass("selected",!1===l)}function w(e){!1===e?_.enterEnabled()&&(_.noCloseOnEnter||a.blur(),_.onEnter&&_.onEnter(n),_.noCloseOnEnter||h(!0)):(_.noCloseOnSelect||a.blur(),_.onSelect&&_.onSelect(i[e]),_.noCloseOnSelect||h(!0))}function y(){m($(this).data("i"))}function v(){var e=_.$results.get(0);e&&(_.$results.toggleClass("topscroll",0<e.scrollTop),_.$results.toggleClass("bottomscroll",e.scrollTop<e.scrollHeight-e.clientHeight))}function b(e){v(),_.resultsNotScrollable?_.$results.offset().top+_.$results.height()-$(window).scrollTop()<2*$(window).height()&&u(i,n,d):this.scrollTop>this.scrollHeight-this.clientHeight-1e3&&u(i,n,d)}function A(e){if(e.metaKey||e.ctrlKey)return!0;clearTimeout(o),e.stopImmediatePropagation(),e.preventDefault(),w($(this).data("i"))}return(_=_||{}).searchEnabled||(_.searchEnabled=function(){return!0}),_.enterEnabled||(_.enterEnabled=function(){return!0}),_.prepareQuery||(_.prepareQuery=function(e){return e.toLowerCase()}),a.data("searchOptions",_),_.$enter&&_.enterEnabled()&&(_.$enter.on("mouseover.search",y),_.$enter.on("mousedown.search",A),_.$enter.data("i",!1)),_.$results.on("hover.search",".search-item",function(){m($(this).data("i"),!0,!0)}),_.$results.on("mouseover.search",".search-item",y),_.$results.on("mousedown.search",".search-item",A),_.resultsNotScrollable?$(window).on("scroll.search",b):(_.$results.on("scroll.search",b),_.$results.isFixed()&&_.$results.blockBodyScroll()),_.initTextarea&&a.initTextarea(_.initTextarea),a.on("keydown.search",function(e){switch(e.which){case Keys.ESC:a.blur();break;case Keys.RETURN:w(l);break;case Keys.UP:if(l)t=l-1;else{if(!_.$enter||!_.enterEnabled())break;t=!1}m(t,!0);break;case Keys.DOWN:var t;(t=!1===l?0:l+1)>i.length-1||m(t,!0);break;default:return}e.stopImmediatePropagation(),e.preventDefault()}),a.on("keyup.search",e),a.on("focus.search",function(){t=!0;var e=a.value();(n!=e||_.searchEnabled()&&!1===_.getData(e))&&f(),g()}),a.on("blur.search",function(){t&&(t=!1,clearTimeout(o),o=setTimeout(h,100,!1),_.onBlur)&&_.onBlur(n)}),a.on("input.search",e),a.on("click.search",function(e){g()}),a.on("disable.search",function(e,t){a.data("disabled",t),a.attr("contenteditable",t?"false":"true"),h(!0)}),a.on("datachange.search",function(){f()}),a.on("contentchange.search",function(){e=(_.resultsNotScrollable?$(window):_.$results).scrollTop();var e,t=_.renderLimit;_.renderLimit=d,f(),_.renderLimit=t,(_.resultsNotScrollable?$(window):_.$results).scrollTop(e)}),_.$results.addClass("collapsed"),_.updateOnInit&&f(),this})},$.fn.hoverTip=function(e,r,t={}){let s=Object.assign({maxWidth:400,bgColor:"rgba(0,0,0,0.85)",color:"#fff",delay:100,throttleTime:50},t),o="hoverTooltip",i=null,n=null,d=!1;return this.on("mouseenter mousemove mouseleave",e,function(a){if("mouseleave"===a.type)clearTimeout(n),clearTimeout(i),$("#"+o).stop(!0,!0).remove(),d=!1;else if(!d){let t="function"==typeof r?r.call(this,a):r;clearTimeout(n),n=setTimeout(()=>{var e=t,l=a;if(e){let n=$("#"+o);n.length?n.text(e):(n=$('<div id="'+o+'"></div>').css({position:"absolute",background:s.bgColor,color:s.color,padding:"8px 12px",borderRadius:"6px",fontSize:"14px",lineHeight:"1.4",maxWidth:s.maxWidth+"px",wordBreak:"break-word",zIndex:99999,pointerEvents:"none",opacity:0}).text(e),$("body").append(n)),i=i||setTimeout(()=>{i=null;var e=n.outerWidth(),t=n.outerHeight(),a=$(window).width(),r=$(window).height();let s=l.pageY+12,o=l.pageX+10;o+e>a-10&&(o=a-e-10),s+t>r-10&&(s=l.pageY-t-10),n.css({top:s,left:o}).stop(!0,!0).animate({opacity:1},120)},s.throttleTime)}d=!0},s.delay)}})},async()=>{var e=$(".pr-header-auth .pr-header-text .js-header_owner_budget .pr-link")?.text()?.match?.(/[-+]?\d*\.?\d+/g)?.[0],t=await getHTML("https://ads.telegram.org/account/stats","h"),a=(new Date).getMonth()+1,t=t.find("tbody").last().find("td").last().text(),r=OwnerAds?.getAdsList()||[],s=r.reduce((e,t)=>e+(+t.qspent||0),0),r=r.reduce((e,t)=>e+(+t.pspent||0),0),o=$(".pr-header-text");let n=a+`Êúà: ${t}  `;e<10&&(a=Math.abs(s-r),n+=`ÔºàÂª∫ËÆÆÂÖÖÂÄº: ${s.toFixed(0)} - ${r.toFixed(0)} ‚âà ${10*Math.ceil(a/10)}Ôºâ`);e=o.find(".mAmount");return 0<e.length?e.text(n):o.append(`<span class="mAmount" style="margin-left: 10px; color: red;">${n}</span>`),t}),getUserText=(window.postData.length&&$(".pr-logo-title").text(`Telegram Ads Â≠òÂú®ÂàÜÊûêÊï∞ÊçÆ${window.postData.length}Êù°`),(e,t)=>{e=e||$(".select")?.val()?.split("?")?.[0]||"";if("jbgq"===e){var a,r=$(".GQClassify")?.val();if(!t?.length)return GQText[r];for(a in GQText)if(GQText[a]?.find(e=>e===t))return GQText[a];return[]}if("JB7777_BOT"===e)if(texts?.[e]?.length)return texts[e].map(e=>e);return texts?.[e]||[]}),getUserUrl=async t=>{var e=$(".select")?.val();if(fbtg?.includes?.(accountObj.adsUid)||tstg?.includes?.(accountObj.adsUid)||jbtg?.includes?.(accountObj.adsUid)){var a=fbtg?.includes?.(accountObj.adsUid)?"JB7777_BOT":tstg?.includes?.(accountObj.adsUid)?"TSYL666bot":jbtg?.includes?.(accountObj.adsUid)?"JBYL_bot":"",r=accountAll?.[accountObj.adsUid]?.code,s=accountAll?.[accountObj.adsUid]?.en??"null";let e="";return(e=t?.length?""+await getShortId(t)+guid(4):guid(9),a&&r)?`t.me/${a}?start=${r}_ADS-${s}-`+e:!1}return"t.me/"+e},getMoney=()=>$(".js-header_owner_budget .pr-link").text().match(/(\d+)(?=\s*\.)/)?.[0]||0,onRefresh=async()=>(window.isLoad=!1,loadADSFlag=!1,await updatePviews(),await updateDayStatis(),Aj.state.adsList=[],window.Aj.reload(),new Promise(e=>{let t=setInterval(async()=>{window.isLoad&&(clearInterval(t),t=null,console.log("Âà∑Êñ∞ÊàêÂäü"),e(!0))},500)})),getADSKey=e=>{var t=e?.tme_path?.split("_")||[];let a=t[t.length-1]||"";return a=a?.toLowerCase()?.includes("ads")?a:`ADS-${accountAll?.[accountObj.adsUid]?.en}-`+e?.ad_id},syncAds=async e=>{e=e?.filter?.(e=>!!e?.ads?.toLowerCase()?.includes("ads"));if(e?.some(e=>""===e?.ads||""===e?.title))return toast("ÈÉ®ÂàÜÂ∏ñÂ≠êÁº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞, ÂêåÊ≠•Â§±Ë¥•");window.post("/ads/syncAds",{list:e})&&toast("Â∏ñÂ≠êÂêåÊ≠•ÊàêÂäü")},syncAdsAll=async()=>{let e=OwnerAds.getAdsList();return e=e?.map(e=>({ads:getADSKey(e),title:e?._title||""})),await syncAds(e),!0},asyncAddAmount=async e=>{let a={owner_id:Aj.state.ownerId,ad_id:e.ad_id,amount:e.add_budget,popup:1};return new Promise(t=>{Aj.apiRequest("incrAdBudget",a,function(e){if(e.error)return t(!1),!1;e.ad&&OwnerAds.updateAd(e.ad),e.header_owner_budget&&$(".js-header_owner_budget").html(e.header_owner_budget),e.owner_budget&&$(".js-owner_budget").html(e.owner_budget),e.ad_budget_val&&$(".js-ad_budget_val").value(e.ad_budget_val),t(!0)})})},addMountFn=async()=>{await onRefresh();let e=OwnerAds.getAdsList(),t=1;if(!(e=e.filter(e=>{if("Active"!==e.status&&"Stopped"!==e.status)return!1;if(e.hasOwnProperty("score")){if(e.score<=50){if(.5<=+e.budget)return!1;e.add_budget=1}else if(e.score<=80){if(1<=+e.budget)return!1;e.add_budget=1}else if(e.score<=100){if(2<=+e.budget)return!1;e.add_budget=2}}else if(+e.actions<1)"Stopped"===e.status&&(e.add_budget=.5);else if(+e.actions<10){if(1<=+e.budget)return!1;e.add_budget=1}else if(+e.actions<30){if(1<=+e.budget)return!1;e.add_budget=2}else if(+e.actions<50){if(3<=+e.budget)return!1;e.add_budget=3}else{if(5<=+e.budget)return!1;e.add_budget=5}return e.url=host+`/account?l=account/ad/${e.ad_id}/edit_budget`,t+=e.add_budget,!0})).length)return toast("È¢ÑÁÆóÂÖÖË∂≥ !!!"),!1;if(getMoney()<1)return clearInterval(timerID),timerID=null,toast("‰ΩôÈ¢ù‰∏çË∂≥ !!!"),!1;Aj.showProgress();for(var a of e)if(await asyncAddAmount(a)&&toast(`${a.title}Â¢ûÂä†${a.add_budget}ÊàêÂäü!`),getMoney()<1)return Aj.hideProgress(),clearInterval(timerID),timerID=null,toast("‰ΩôÈ¢ù‰∏çË∂≥ !!!"),await onRefresh(),!1;Aj.hideProgress(),toast("Â¢ûÂä†È¢ÑÁÆóÂÆåÊàê"),await onRefresh()},editCPM=async(r,s)=>new Promise((a,e)=>{var t={owner_id:Aj.state.ownerId,ad_id:r.ad_id,cpm:s};Aj.apiRequest("editAdCPM",t,async function(e){if(e.error)return a(!1),!1;var t=getADSKey(r);await window.post("/ads/recordCpm",{ads:t,cpm:s,float:(s-r.cpm).toFixed(2),views:r?.views||0,clicks:r?.clicks||0,actions:r?.actions||0});e.ad&&OwnerAds.updateAd(e.ad),a(!0)})}),onProPrice=async()=>{let e=OwnerAds.getAdsList();if(!(e=e.filter(e=>"Active"===e.status&&e.qviews<+minViews&&($(`a[href="/account/ad/${e.ad_id}"]`).first().parents("tr").find("td").css("backgroundColor","rgb(17, 154, 245, .5)"),!0)))?.length)return toast("ÂÖ®ÈÉ®ËææÊ†á");console.log(e),Aj.showProgress();var t=e.map(async e=>{let t=0;t=(e?.qviews<.3*+minViews?.04*e.cpm:e?.qviews<.5*+minViews?.02*e.cpm:.01*e.cpm).toFixed(2);var a=(e.cpm+ +t).toFixed(2);return editCPM(e,a)}),t=await Promise.all(t),a=t.filter(e=>e)?.length,t=t.filter(e=>!e)?.length;Aj.hideProgress(),toast(`Âä†‰ª∑ÂÆåÊàêÔºöÊàêÂäü${a}Êù°ÔºåÂ§±Ë¥•${t}Êù°`),await onRefresh()},onProAddPrice=async()=>{let e=OwnerAds.getAdsList();if(!(e=e.filter(e=>"Active"===e.status&&e.qviews>+minViews&&e.qviews<=20*+minViews&&($(`a[href="/account/ad/${e.ad_id}"]`).first().parents("tr").find("td").css("backgroundColor","rgb(17, 154, 245, .5)"),!0)))?.length)return toast("ÂÖ®ÈÉ®ËææÊ†á");console.log(e),Aj.showProgress();var t=e.map(async e=>{let t=0;t=(e?.qviews>10*+minViews?.01*e.cpm:e?.qviews>5*+minViews?.02*e.cpm:.03*e.cpm).toFixed(2);var a=(e.cpm+ +t).toFixed(2);return editCPM(e,a)}),t=await Promise.all(t),a=t.filter(e=>e)?.length,t=t.filter(e=>!e)?.length;Aj.hideProgress(),toast(`Âä†‰ª∑ÂÆåÊàêÔºöÊàêÂäü${a}Êù°ÔºåÂ§±Ë¥•${t}Êù°`),await onRefresh()},getDailyClickLimit=(e,t=3)=>{var a=autoADSData.date.getBeijingString("YYYY-MM-DD");let r=JSON.parse(localStorage.getItem("clickLimits")||"{}");r[e]&&r[e].date===a||(r[e]={date:a,count:0},localStorage.setItem("clickLimits",JSON.stringify(r)));a=Math.max(0,t-r[e].count);return{canClick:0<a,remaining:a,recordClick(){return r[e].count<t&&(r[e].count++,localStorage.setItem("clickLimits",JSON.stringify(r))),Math.max(0,t-r[e].count)}}},getAdsDayStatis=async e=>{var t,e=`https://ads.telegram.org/account/${e?"ad/"+e+"/":""}stats?period=day`,e=(await getHTML(e,"j",!1))[0].j,a=extractMiddleMultiple(e,'columns":',',"types'),r={data:{}},s={...accountObj,views:0,clicks:0,actions:0,spents:0,details:[]},e=autoADSData.date.getBeijingString("HH"),o=autoADSData.date.getBeijingString("YYYY-MM-DD");+e<8&&s.details.push({date:o,cpmChange:r.data?.[o],views:0,clicks:0,actions:0,spents:0});for(let e=a?.[0]?.[0]?.length-1;0<=e;e--)0!==e&&(t=autoADSData.date.formatCustomDate(a[0][0][e],"YYYY-MM-DD"),s.views+=a?.[0]?.[1]?.[e]||0,s.clicks+=a?.[0]?.[2]?.[e]||0,s.actions+=a?.[0]?.[3]?.[e]||0,s.spents+=a?.[1]?.[1]?.[e]||0,s.details.push({date:t,cpmChange:r.data?.[t],views:a?.[0]?.[1]?.[e]||0,clicks:a?.[0]?.[2]?.[e]||0,actions:a?.[0]?.[3]?.[e]||0,spents:((a?.[1]?.[1]?.[e]||0)/1e6).toFixed(4)}));return s.spents=(s.spents/1e6).toFixed(4),s},onBotVerifyOne=async s=>new Promise(async t=>{let a=s.title,e=s?.tgName||"";var r;if(e||(r=""+host+s?.base_url,r=await getHTML(r,"h"),e=r.find(".plus .value").attr("href")),!["bot","channel"].includes(s?.trg_type))return t({code:1,message:"ÊêúÁ¥¢ÂπøÂëä"});Aj.apiRequest(["bot"].includes(s?.trg_type)?"searchBot":"searchChannel",{owner_id:Aj.state.ownerId,query:e},e=>e.error?t({code:1,message:e.error}):t({code:0,message:a+"ÔºöÁ¨¶ÂêàÊäïÊîæÊù°‰ª∂"}),e=>t({code:1,message:e}))}),showTablePopup=(e,t)=>{var a,r;$(".popup-overlay").length||(a=$('<div class="popup-overlay" style="position: fixed;top: 0;left: 0;width: 100%;height: 100%;background-color: rgba(0, 0, 0, 0.5);z-index: 9998;display: none;"></div>'),r=$(`
				<div class="popup-window" style="position: fixed; top: 10%; left: 30%; min-width: 40%; max-width: 80%; background: #fff; border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 5px; z-index: 9999; display: none;">
				<div class="close-btn" style="position: absolute; top: 8px; right: 12px; cursor: pointer; font-size: 20px; color: #888;">&times;</div>
				<div class="table-container" style="max-height: 800px; overflow-y: auto;"></div>
				</div>
			`),$("body").append(a).append(r),r.find(".close-btn").on("click",()=>$(".popup-overlay, .popup-window").fadeOut()));let s='<table style="width: 100%; border-collapse: collapse; margin-top: 10px;"><thead><tr>';e.forEach(e=>{s+=`<th style="border: 1px solid #ccc; padding: 8px; text-align: left;">${e.label}</th>`}),s+="</tr></thead><tbody>",t.forEach(t=>{s+="<tr>",e.forEach(e=>{e?.render?s+=`<td style="border: 1px solid #ccc; padding: 8px; text-align: left;">${e.render(e,t)}</td>`:s+=`<td style="border: 1px solid #ccc; padding: 8px; text-align: left;">${null!=t[e.field]?t[e.field]:""}</td>`}),s+="</tr>"}),s+="</tbody></table>",$(".popup-window .table-container").html(s),$(".popup-overlay, .popup-window").fadeIn()},onCPMOptimize=async()=>{let e=OwnerAds.getAdsList();if(!(e=e?.filter?.(e=>["Active","Stopped"].includes(e?.status)))?.length)return toastErr("Ê≤°ÊúâÁ¨¶ÂêàË¶ÅÊ±ÇÁöÑÊï∞ÊçÆ!");var t=getDailyClickLimit("CPMOptimize",3);if(t.canClick&&3===t.remaining&&!await confirm("CPM Âü∫‰∫éÊò®Êó•ÊµèËßàÈáèËá™Âä®‰ºòÂåñÔºåÊúüÈó¥ËØ∑‰∏çË¶ÅÂà∑Êñ∞È°µÈù¢ÔºåÊ≤°ÈóÆÈ¢òËØ∑ÁÇπÂáªÁ°ÆËÆ§ÊåâÈíÆ!"))return!1;if(t.canClick&&3-t.remaining&&!await confirm(`‰ªäÊó•Â∑≤‰ºòÂåñ${3-t.remaining}Ê¨°‰ª∑Ê†º,ÊòØÂê¶ËøòÈúÄË¶Å‰ºòÂåñ?`))return!1;if(!t.canClick)return toastErr("‰ªäÊó•Â∑≤‰ºòÂåñ‰ª∑Ê†º3Ê¨°ÔºåÈúÄË¶ÅËßÇÂØüÊï∞ÊçÆÔºå‰∏çÂÆúÈ¢ëÁπÅÊìç‰ΩúÔºÅ"),!1;t.recordClick();Aj.showProgress();let a=autoADSData.date.getBeijingString("YYYY-MM-DD"),r=autoADSData.date.getBeijingString("YYYY-MM-DD",-1);var s,o=[];for(s of e){var{title:n,ad_id:l,cpm:i}=s,l=(console.log(n+" Â§ÑÁêÜ‰∏≠"),await getAdsDayStatis(l)),d=l?.details?.reduce((e,t)=>e+([a,r].includes(t?.date)?+t.views:0),0),l=l?.details?.find?.(e=>e.date===r)?.views||0;if(0==+d)if(1===(await onBotVerifyOne(s))?.code){o.push({title:n,cpm:i,views:l,status:"‰∏çÂ§ÑÁêÜ",diff:"Êó•Ê¥ªË∑É‰∏çË∂≥"});continue}if(l<minViews)if(100<i)o.push({title:n,cpm:i,views:l,status:"‰∏çÂ§ÑÁêÜ",diff:"Âçï‰ª∑ËøáÈ´òÔºåÊ∏†ÈÅìË¥®Èáè‰∏ç‰Ω≥ÊàñÊñáÊ°à‰∏ç‰Ω≥"});else{let e=Math.abs(l-minViews)/300;e=(e=.01<e?e:.01)<5?e:5,e=Number(e.toFixed(2));d=Number((i+e).toFixed(2));o.push({title:n,cpm:i,views:l,status:"Âä†‰ª∑",diff:"+"+e}),await editCPM(s,d)}else if(l>minViews)if(l<5*minViews)o.push({title:n,cpm:i,views:l,status:"‰∏çÂ§ÑÁêÜ",diff:"ÊµèËßàÈáèÊ≠£Â∏∏"});else{let e=Math.abs(l-5*minViews)/600;e=(e=.01<e?e:.01)<5?e:5,e=Number(e.toFixed(2));d=Number((i+e).toFixed(2));console.log(s.title+"ÂáÜÂ§áÈôç‰ª∑Ôºö"+e),o.push({title:n,cpm:i,views:l,status:"Âéã‰ª∑",diff:"-"+e}),await editCPM(s,d)}}Aj.hideProgress();await onRefresh(),showTablePopup([{field:"title",label:"Ê†áÈ¢ò"},{field:"cpm",label:"Âçï‰ª∑"},{field:"views",label:"Êò®Êó•ÊµèËßà"},{field:"status",label:"Áä∂ÊÄÅ"},{field:"diff",label:"ÁªìÊûú",render:(e,t)=>`<span class="${-1!==t[e.field]?.indexOf("+")?"red":-1!==t[e.field]?.indexOf("-")?"green":""}">${t[e.field]}</span>`}],o)},onFilter=async()=>{let e=OwnerAds.getAdsList();e=e.filter(e=>"On Hold"!==e.status&&2e3<e.views&&e.ctr<1&&e.cvr<10&&($(`a[href="/account/ad/${e.ad_id}"]`).first().parents("tr").find("td").css("backgroundColor","rgb(17, 154, 245, .5)"),!0))},searchChannel=($("body").on("click",'td[style="display:var(--coldp-cpm,table-cell)"] a',async function(e){e.preventDefault(),e.stopPropagation();e=OwnerAds.getAdsList();let t=$(this).attr("href")?.split("/")?.[3];if(!t)return!1;var e=e?.find?.(e=>+e?.ad_id==+t),a=await prompt(e?._title||e?.title);if(a<=0)return!1;Aj.showProgress();e=await editCPM(e,a);if(Aj.hideProgress(),!e)return toast("ËÆæÁΩÆcpmÂ§±Ë¥• !");await onRefresh()}),(a,r)=>new Promise((t,e)=>{Aj.apiRequest(a?"searchBot":"searchChannel",{owner_id:Aj.state.ownerId,query:r},e=>{if(e.error)return t(!1),!1;e.ok?(e={val:a?e.bot.id:e.channel.val,name:a?e.bot.title:e.channel.name,photo:(a?e.bot:e.channel).photo,username:(a?e.bot:e.channel).username},t(e)):t(!1)},e=>{console.log("ËØ∑Ê±ÇÈîôËØØ",e),t(!1)})})),onTargetQuerySearch=e=>new Promise(a=>{Aj.apiRequest("searchTargetQuery",{query:e},e=>{if(e.error)return a(!1);var t;e.query&&(t=(new DOMParser).parseFromString(e?.query?.sample_results,"text/html"),0<$(t).find(".empty").length?a(!1):(t={val:e.query.id,name:e.query.title,sample_results:e.query.sample_results},a(t)))})}),createAd=async a=>{let e={owner_id:Aj.state.ownerId,button:void 0,website_name:"",website_photo:"",media:"",ad_info:"",views_per_user:getRNum(1,4),daily_budget:999,active:1,device:void 0};var{title:t="",text:r="",promote_url:s="",cpm:o=0,target_type:n=""}=a;return"search"===n||t&&r&&s&&o?new Promise(t=>{Aj.apiRequest("createAd",{...e,...a},async e=>{e.error?t(!1):(await syncAds([{ads:a?.promote_url?.split("_")?.pop()||"",title:a.title||""}]),t(!0))})}):toast("Ê†áÈ¢ò„ÄÅÊñáÊ°à„ÄÅÊé®ÂπøÈìæÊé•„ÄÅCPM ‰∏çËÉΩ‰∏∫Á©∫")},editAd=async e=>{var t=e.tme_path?.split?.("?")?.[0],t=getUserText({tsyl:"TSYL666bot",tsyx:"TSYL666bot",jbtb:"JB7777_BOT",jbyx:"JB7777_BOT",jbdp:"JBYL_bot"}[t]||t,e.text);if(!t?.length)return!1;var a=(await getHTML("https://ads.telegram.org/account/ad/"+e.ad_id,"h")).find('input[name="media"]')?.val()||"";let r={owner_id:Aj.state.ownerId,ad_id:e.ad_id,title:e?._title||e?.title,text:t[getRNum(0,t.length-1,0)],promote_url:"t.me/"+e.tme_path,website_name:"",website_photo:"",media:a,ad_info:"",cpm:e.cpm,daily_budget:e.daily_budget||0,active:1,views_per_user:getRNum(1,4)};return new Promise((t,e)=>{Aj.apiRequest("editAd",r,function(e){e.error&&t(!1),t(!0)})})},deleteAd=async(a,r=Aj.state.ownerId)=>new Promise((t,e)=>{Aj.apiRequest("deleteAd",{owner_id:r,ad_id:a},e=>{if(e.error)return t(!1);Aj.apiRequest("deleteAd",{owner_id:r,ad_id:a,confirm_hash:e.confirm_hash},e=>e.ok?t(!0):t(!1))})}),onReview=async()=>{await onRefresh();let e=OwnerAds.getAdsList();if(!(e=e.filter(e=>"Declined"===e.status&&"search"!==e.trg_type&&(e.url=""+host+e.base_url,!0))).length)return toast("Ê≤°ÊúâÈúÄË¶ÅÂÆ°Ê†∏ÁöÑÂπøÂëä !!!");Aj.showProgress();var t,a=[];for(t of e){var r=await editAd(t);a.push(r)}var s=a.filter(e=>e)?.length,o=a.filter(e=>!e)?.length;Aj.hideProgress(),toast(`ÂÆ°Ê†∏ÂÆåÊàêÔºöÊàêÂäü${s}Êù°ÔºåÂ§±Ë¥•${o}Êù°`),await onRefresh()},onReplace=async()=>{let e=OwnerAds.getAdsList();if(!(e=e.filter(e=>"Active"===e.status&&!(50<=e.views||0<e.pviews||(e.url=""+host+e.base_url,0)))).length)return toast("Ê≤°ÊúâÈúÄË¶ÅÂÆ°Ê†∏ÁöÑÂπøÂëä !!!"),!1;var t=e.map((a,e)=>{let t=a.tme_path?.split?.("?")?.[0],r=("tsyl"===t||"tsyx"===t?t="TSYL666bot":"jbtb"!==t&&"jbyx"!==t||(t="JB7777_BOT"),getUserText(t,a.text));return new Promise(t=>{var e={owner_id:Aj.state.ownerId,ad_id:a.ad_id,title:a?._title||a?.title,text:r[getRNum(0,r.length-1,0)],promote_url:"t.me/"+a.tme_path,website_name:"",website_photo:"",media:"",ad_info:"",cpm:a.cpm,daily_budget:0,active:1,views_per_user:getRNum(1,4)};Aj.apiRequest("editAd",e,function(e){e.error&&t(!1),t(!0)})})}),t=(Aj.showProgress(),await Promise.all(t)),a=t.filter(e=>e)?.length,t=t.filter(e=>!e)?.length;Aj.hideProgress(),toast(`ÊõøÊç¢ÂÆåÊàêÔºöÊàêÂäü${a}Êù°ÔºåÂ§±Ë¥•${t}Êù°`),await onRefresh()},onDels=async()=>{let r=OwnerAds.getAdsList()?.filter(e=>"Declined"===e.status&&e?.score<30&&($(`a[href="/account/ad/${e.ad_id}"]`).first().parents("tr").find("td").css("backgroundColor","rgb(17, 154, 245, .5)"),!0));if(!r.length)return toast("ÊöÇÊó†ÂèØÂà†Èô§ÂπøÂëä !!!");if(!await confirm(`Âà†Èô§Êï∞Èáè ${r.length} Êù°`))return await onRefresh(),!1;var e=r.map(e=>{let a={owner_id:Aj.state.ownerId,ad_id:e.ad_id};return new Promise(t=>{Aj.apiRequest("deleteAd",a,e=>{e.error?t(!1):t(e.confirm_hash)})})}),e=(await Promise.all(e)).filter((e,t)=>{if(!e)return!1;let a={owner_id:Aj.state.ownerId,ad_id:r[t].ad_id,confirm_hash:e};return new Promise(t=>{Aj.apiRequest("deleteAd",a,e=>{e.ok?t(!0):t(!1)})})});if(!e.length)return toast("ÂπøÂëäÂÜ∑Âç¥‰∏≠, ËØ∑Á®çÂêéÂà†Èô§ !!!");Aj.showProgress();var e=await Promise.all(e),t=e.filter(e=>e)?.length,e=e.filter(e=>!e)?.length;Aj.hideProgress(),toast(`Âà†Èô§ÂπøÂëäÔºöÊàêÂäü${t}Êù°ÔºåÂ§±Ë¥•${e}Êù°, ${r.length-t-e}Êù°Ê≠£Âú®ÂÜ∑Âç¥`,async()=>{await onRefresh()})},onSearchADS=async()=>{let e=$(".urls").value(),t=/^[A-Za-z0-9\u4e00-\u9fa5@]{4,}$/;if(!e.length)return toast("ËØ∑ÂÖàËÆæÁΩÆÊêúÁ¥¢ÂÖ≥ÈîÆËØç");if(!(e=(e=e.split(/\r?\n/)).filter(e=>t.test(e))).length)return toast("Â∑≤ÂâîÈô§‰∏çÁ¨¶ÂêàÁöÑÂÖ≥ÈîÆËØçÔºåÂâ©‰Ωô0Êù°Á¨¶Âêà");var a=(e=10<e.length?e.slice(0,10):e).map(async e=>onTargetQuerySearch(e)),a=await Promise.all(a);if(!a.length)return toast("Ê≤°ÊúâÁ¨¶ÂêàÁöÑÂÖ≥ÈîÆËØç");var r=parseFloat($("#minPrice").val()),s=parseFloat($("#maxPrice").val()),o=parseFloat($("#minBudget").val()),n=parseFloat($("#maxBudget").val());let l=[],i=[];a.map(e=>{e?.name&&e?.val&&(l.push(e.name),i.push(e.val))});a={title:l=32<(l=l.join(" | ")).length?l.slice(0,32):l,text:"",promote_url:await getUserUrl(),cpm:getRNum(r,s,1),budget:getRNum(o,n),target_type:"search",channels:"",bots:"",search_queries:i.join(";"),method:"createAd"},Aj.showProgress(),NewAd.saveDraftAuto(!0),r=await createAd(a);Aj.hideProgress(),r&&(NewAd.saveDraftAuto(!0),toast("ÂèëÂ∏ÉÊàêÂäü !!!"),$(".urls").val(""),await onRefresh())},sendChannel=async()=>{let e=$(".urls").value();if(!e.length)return toast("ËØ∑ÂÖàËÆæÁΩÆÈ¢ëÈÅì/Êú∫Âô®‰∫∫ÈìæÊé•");e=e.split(/\r?\n/);var r=getUserText();if(!r?.length)return!1;Aj.showProgress();var s,o=[];for(s of e){let t=/bot$/i.test(s),a=await searchChannel(t,s);if(a||(t=!0,a=await searchChannel(t,s))){var n=parseFloat($("#minPrice").val()),l=parseFloat($("#maxPrice").val()),i=parseFloat($("#minBudget").val()),d=parseFloat($("#maxBudget").val());let e=a?.name?.replace(/<[^>]+>/g,"");var c=19<(e=e.replace(/[\u{1D400}-\u{1D7FF}]/gu,""))?.length?e?.slice(0,19):e,u=a?.val,n={title:c,text:r[getRNum(0,r.length-1,0)],promote_url:await getUserUrl(s),cpm:getRNum(n,l,1),budget:getRNum(i,d),target_type:t?"bots":"channels"},l=(t?n.bots=u:n.channels=u,await createAd(n));o.push(l),l?toast(c+"ÔºåÂèëÂ∏ÉÊàêÂäüÔºÅ"):toast(c+"ÔºåÂèëÂ∏ÉÂ§±Ë¥•ÔºÅ")}else toast(s+"ÔºåÂèëÂ∏ÉÂ§±Ë¥•ÔºÅ"),o.push(!1)}var t=o.filter(e=>e)?.length,a=o.filter(e=>!e)?.length;Aj.hideProgress(),$(".urls").val(""),toast(`ÂπøÂëäÂèëÂ∏ÉÔºöÊàêÂäü${t}Êù°ÔºåÂ§±Ë¥•${a}Êù°`),await onRefresh()},sendMoreChannel=async()=>{let e=$(".urls").value();if(!e.length)return toast("ËØ∑ÂÖàËÆæÁΩÆÈ¢ëÈÅì/Êú∫Âô®‰∫∫ÈìæÊé•");var t=parseFloat($("#minPrice").val()),a=parseFloat($("#maxPrice").val()),r=parseFloat($("#minBudget").val()),s=parseFloat($("#maxBudget").val());e=e.split(/\r?\n/);let o=/bot$/i.test(e?.[0]);var n=e.map(async e=>searchChannel(o,e)),n=await Promise.all(n);let l="",i=[];n.map(e=>{if(!e)return!1;var t;l.length||(t=e?.name?.replace(/<[^>]+>/g,""),l=19<t.length?t.slice(0,19):t),i.push(e.val)});n=getUserText(),n={title:l,text:n[getRNum(0,n.length-1,0)],promote_url:await getUserUrl(),cpm:getRNum(t,a,1),budget:getRNum(r,s),target_type:o?"bots":"channels"},o?n.bots=i.join(";"):n.channels=i.join(";"),Aj.showProgress(),NewAd.saveDraftAuto(!0),t=await createAd(n);Aj.hideProgress(),t&&(NewAd.saveDraftAuto(!0),toast("ÂèëÂ∏ÉÊàêÂäü !!!"),$(".urls").val(""),await onRefresh())},onReplaceBot=async()=>{let e=OwnerAds.getAdsList();if(!(e=e.filter(e=>"Declined"===e.status&&"search"!==e.trg_type&&(e.url=""+host+e.base_url,!0))).length)return toast("ÊâÄÊúâÊú∫Âô®‰∫∫Â∑≤ÁªèÊõøÊç¢ÂÆåÊàê !!!"),!1;if(getMoney()<2)return toast("‰ΩôÈ¢ùËøá‰Ωé");var t,a=Aj.state.ownerId;for(t of e){Aj.showProgress();var r=await getHTML(t.url,"h"),s=r.find(".select").data("value"),o="bot"===t.trg_type,n={title:t.title,text:t.text,promote_url:"t.me/"+t.tme_path?.replace(/JB6666_BOT/gi,"JB7777_BOT"),cpm:t.cpm,budget:1,target_type:t.trg_type},s=(o?n.bots=s:n.channels=s,await createAd(n));if(!s){let a=[];r?.find?.(".selected-item")?.each(function(){var e=$(this).data("val"),t=$(this).find(".label").text().trim();a.push({id:e,title:t})});for(var l of a){var i={title:l.title,text:t.text,promote_url:`t.me/${t.tme_path?.replace(/JB6666_BOT/gi,"JB7777_BOT")}-`+l.id,cpm:t.cpm,budget:1,target_type:o?"bots":"channels"};o?n.bots=l.id:n.channels=l.id,await createAd(i)}}await deleteAd(t.ad_id,a),Aj.hideProgress(),toast(t.title+"Êñ∞Âª∫ÊàêÂäü, ÊóßÂπøÂëäÂ∑≤Âà†Èô§!")}await onRefresh()},onGetENFilter=async()=>{var e=await window.get("/ads/getAdsUEN",{ads:accountAll?.[accountObj.adsUid]?.en},Aj.state.ownerId);console.log(e.data)},onGetTodayData=async()=>{await syncAdsAll();var e=await window.get("/ads/getTodayData",{ads:accountAll?.[accountObj.adsUid]?.en},Aj.state.ownerId);console.log(e.data)},onBotVerify=($(document).on("click",".pviews",async function(){var e=$(this).closest("tr")?.index(),e=OwnerAds?.getAdsList()?.[e];let t=e.title;var a=""+host+e?.base_url,a=(await getHTML(a,"h")).find(".plus .value").attr("href");if(!["bot","channel"].includes(e?.trg_type))return!1;Aj.apiRequest(["bot"].includes(e?.trg_type)?"searchBot":"searchChannel",{owner_id:Aj.state.ownerId,query:a},e=>{e.error?toastErr(""+t,""+e.error):toast(t+"ÔºöÁ¨¶ÂêàÊäïÊîæÊù°‰ª∂")},e=>{toastErr("ËØ∑Ê±ÇÈîôËØØ",""+e)})}),async e=>{let t=e||$(".urls").value();if(!t.length)return toast("ËØ∑ÂÖàËÆæÁΩÆÊú∫Âô®‰∫∫ÈìæÊé•");var a,r=[];for(a of t=t.split(/\r?\n/)){var s=await getShortId(a),o=await((t,r)=>new Promise((a,e)=>{Aj.apiRequest(t?"searchBot":"searchChannel",{owner_id:Aj.state.ownerId,query:r},t=>{if(t.error)return a({code:1,username:r,error:t.error}),!1;if(t.ok){let e=t.bot.title?.replace(/<[^>]+>/g,"");t={code:0,name:e=19<(e=e.replace(/[\u{1D400}-\u{1D7FF}]/gu,""))?.length?e?.slice(0,19):e,username:r};a(t)}else a({code:1,username:r})},e=>{a({code:1,username:r,error:e})})}))(!0,a);0===o?.code?r.push({code:0,shortId:s,isPlace:1,title:o?.name||"",username:o?.username||""}):1===o?.code&&o?.error?.includes?.("1000+")&&r.push({code:1,shortId:s,isPlace:0,title:o?.name||"",username:o?.username||""})}console.log("tmpList",r),r.map(e=>{0===e.code?console.log(`ÂèØÊäïÊîæÔºö${e.title} - `+e.username?.replace(/https:\/\/t.me\//,"")):1===e.code&&console.log("Êó•Ê¥ªË∑É‰∏çË∂≥Ôºö"+e.username?.replace(/https:\/\/t.me\//,""))});e=r?.map?.(({shortId:e,isPlace:t})=>({shortId:e,isPlace:t}));await window.post("/api/channel/batchUpdate",e,Aj.state.ownerId)}),getAdsStatis=async()=>{var e=(await getHTML("https://ads.telegram.org/account/stats?period=day","j",!1))[0].j,t=extractMiddleMultiple(e,'columns":',',"types'),a={...accountObj,views:0,clicks:0,actions:0,spents:0};for(let e=0;e<t[0][0]?.length;e++)0!==e&&(a.views+=t[0][1][e],a.clicks+=t[0][2][e],a.actions+=t[0][3][e],a.spents+=t[1][1][e]);return console.log("ÊÄªÊï∞ÊçÆ",a),a},extractMiddleMultiple=(e,t,a)=>{for(var r,s=new RegExp(t+"(.*?)"+a,"g"),o=[];null!==(r=s.exec(e));)o.push(JSON.parse(r[1]));return o},showIframePopup=async(e,t)=>{$("#popupOverlay").length&&$("#popupOverlay").remove();var e=(await getHTML(e+"/stats?period=day","j",!1))[0].j,e=extractMiddleMultiple(e,'columns":',',"types'),o=(console.log("Êó•Êï∞ÊçÆ",e),e[0]?.[0]||[]),n=e[0]?.[1]||[],l=e[0]?.[2]||[],i=e[0]?.[3]||[],d=e[1]?.[1]||[],e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),8,0,0,0);if(e<a&&(e=a.getTime(),o.push(e),n.push(0),l.push(0),i.push(0),d.push(0)),!o?.length)return toast("ÊöÇÊó†Êï∞ÊçÆ !!!");var c=(await window.get("/ads/cpmList",{ads:t}))?.data||[],u=(console.log("cpms",c),[]);for(let e=o?.length-1;0<=e;e--)if(0!==e){if(15<=u.length)break;{let a=timestampToDate(o[e]),r=[],s=[];c.map(e=>{var t=e.createDate.split(" ");a===t[0]&&(r.push(`${t[1]}: ${e.float} = `+e.cpm),s.push(e.float))});u.push({date:a,cpm:r,float:s,view:n?.[e]||0,click:l?.[e]||0,action:i?.[e]||0,total:+(d[e]/1e6).toFixed(4)})}}let r=`<table width="100%" border><thead><tr>
                <th style="padding: 5px 12px;">Êó•Êúü</th>
                <th style="padding: 5px 12px;">CPM</th>
                <th style="padding: 5px 12px;">Â±ïÁ§∫</th>
                <th style="padding: 5px 12px;">ÁÇπÂáª</th>
                <th style="padding: 5px 12px;">Âä†ÂÖ•</th>
                <th style="padding: 5px 12px;">Ê∂àËÄó</th>
            </tr></thead><tbody>`;u?.map(a=>{r+=`
                    <tr>
                        <td style="padding: 5px 12px;">${a.date}</td>
                        <td style="padding: 5px 12px;">`,a?.cpm?.map?.((e,t)=>{r+=`
                        <div>
                            ${e.slice(0,9)}
                            <span style="color: ${0<+a.float[t]?"red":"green"};">
                            ${e.slice(10,e.length)}
                            </span>
                        </div>
                    `}),r+=`</td>
                    <td style="padding: 5px 12px;">${a.view}</td>
                    <td style="padding: 5px 12px;">${a.click}</td>
                    <td style="padding: 5px 12px;">${a.action}</td>
                    <td style="padding: 5px 12px;">${a.total}</td>
                    </tr>
                `}),r+="</tbody></table>";a=$(`
            <div id="popupOverlay" style="position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
                <div id="popupBody" style="background: white; padding: 30px; width: 40%; border-radius: 10px; overflow: hidden; position: relative;">
                ${r}
                <button id="closePopup" style="position: absolute; top: 10px; right: 10px; background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ÂÖ≥Èó≠</button>
                </div>
            </div>
            `);$("body").append(a),$("#iframePopup").on("load",async function(){var e=$(this)[0].contentWindow.document;$(e).find(".nav-pills").eq(1).find("li").last().find("a")[0].click(),await sleep(1e3),$(e).find(".pr-header").hide(),$(e).find(".pr-page-tabs").hide(),$(e).find(".pr-review-ad").hide()}),$("#closePopup").on("click",()=>{$("#popupOverlay").remove()})},updatePviews=($("body").on("dblclick","tbody>tr",function(e){var t=OwnerAds.getAdsList()[$(this).index()],a=t.base_url,r=(r=t?.tme_path?.split("_"))?.[r?.length-1];console.log(t),showIframePopup(a,r)}).on("contextmenu","tbody>tr .pr-cell-title",function(e){e?.preventDefault(),e?.stopPropagation();e=(e=OwnerAds.getAdsList()[$(this).parent().parent().index()]?.tme_path?.split("_"))?.[e?.length-1];copyText(e)}),$("body").hoverTip(".table tbody>tr .pr-cell-title",function(){var e=$(this).closest("tr").index();return(OwnerAds?.getAdsList()?.[e])?.text||""},{delay:100,throttleTime:60,maxWidth:400}),async(t=!0,e)=>{var a=OwnerAds?.getAdsList?.()||[];let r=0,s=0;a=a?.map?.(e=>{var t=getADSKey(e);return r+=+(e?.qspent||0),s+=+(e?.pspent||0),{ads:t,title:e?.title||"",views:e?.views||0,clicks:e?.clicks||0,actions:e?.actions||0,spent:e?.spent||0}});if(!a?.length)return!1;a={platform:platformText,adsUid:accountObj.adsUid,adsUser:accountObj.adsUname,list:a};if(!t){t=$(".pr-header-auth .pr-header-text .js-header_owner_budget .pr-link")?.text()?.match?.(/[-+]?\d*\.?\d+/g)?.[0];let e=await getMonthTotal();e=parseInt(e?.match?.(/[-+]?\d{1,3}(?:,\d{3})*(?:\.\d+)?|[-+]?\d+(?:\.\d+)?/g)?.[0]?.replace(/,/g,"")||"",10),t&&t<10&&[...fbtg,...tstg].includes?.(accountObj.adsUid)&&(a.budget=t,a.ySpent=r.toFixed(0),a.tSpent=s.toFixed(0))}await window.post("/ads/recordViews",a)&&console.log("ËßÇÁúãÈáèÊõ¥Êñ∞ÊàêÂäü")}),updateDayStatis=async(e=0,t)=>{var a=await getAdsStatis(),a=(a.spents=+(a.spents/1e6).toFixed(4),await window.post("/ads/recordAdsDayStatis",a));a&&console.log("ÊØèÊó•ÊÄªÊï∞ÊçÆÊõ¥Êñ∞ÊàêÂäü")},runMyTask=async e=>{await addMountFn(),1===accountAll[accountObj.adsUid]?.options?.length&&await onReview(),await updatePviews(!1,e),await updateDayStatis(!1,e)},loop=()=>{animationFrameId=requestAnimationFrame(loop);var e=new Date(autoADSData.date.getBeijingString()),t=e.getHours(),a=e.getMinutes(),e=e.getSeconds();![15,30,45,55].includes(a)||0!==e||loop.lastTrigger&&loop.lastTrigger===t+"-"+a||(loop.lastTrigger=t+"-"+a,runMyTask(23===t&&55===a))},stopLoop=(loop(),()=>{cancelAnimationFrame(animationFrameId)});window.loadFinish=!0})();